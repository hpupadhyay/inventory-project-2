{% extends "inventory/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<h2 class="text-3xl font-bold mb-6">Historical Opening Stock</h2>

<div class="bg-white p-6 rounded-lg shadow-md mb-8">
    <h3 class="text-xl font-bold mb-4">Add / Update an Opening Stock Record</h3>
    <p class="text-sm text-gray-600 mb-4">Use this form to set the initial stock quantity for an item at the beginning of an accounting period (e.g., the start of the financial year). This record is historical and will **not** be changed by daily transactions.</p>
    <form method="post" class="space-y-4">
        {% csrf_token %}
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            {{ form|crispy }}
        </div>
        <div class="flex justify-end">
            <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Save Record</button>
        </div>
    </form>
</div>

<div class="bg-white p-6 rounded-lg shadow-md overflow-x-auto">
    <h3 class="text-xl font-bold mb-4">Saved Opening Stock Records</h3>
    <table class="min-w-full bg-white text-sm">
        <thead class="bg-gray-100">
            <tr>
                <th class="py-2 px-3 border-b text-left">Date</th>
                <th class="py-2 px-3 border-b text-left">Item Name</th>
                <th class="py-2 px-3 border-b text-left">Warehouse</th>
                <th class="py-2 px-3 border-b text-right">Opening Quantity</th>
				<th class="py-2 px-3 border-b text-left">Actions</th> </tr>
            </tr>
        </thead>
        <tbody>
            {% for record in stock_records %}
            <tr class="hover:bg-gray-50">
                <td class="py-2 px-3 border-b">{{ record.date }}</td>
                <td class="py-2 px-3 border-b">{{ record.item.name }}</td>
                <td class="py-2 px-3 border-b">{{ record.warehouse.name }}</td>
                <td class="py-2 px-3 border-b text-right">{{ record.quantity|floatformat:2 }}</td>
				<td class="py-2 px-3 whitespace-nowrap">
                <a href="{% url 'opening_stock_edit' record.pk %}" class="text-blue-600 hover:text-blue-800" title="Edit"><i class="fas fa-edit"></i></a>
                <a href="{% url 'opening_stock_delete' record.pk %}" class="text-red-600 hover:text-red-800 ml-2" title="Delete"><i class="fas fa-trash-alt"></i></a>
            </td>
            </tr>
            {% empty %}
            <tr><td colspan="4" class="py-4 text-center text-gray-500">No opening stock records have been created yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
$(document).ready(function() {
    // Initialize the form dropdowns as searchable
    $('#id_item').select2({ theme: "classic", width: '100%' });
    $('#id_warehouse').select2({ theme: "classic", width: '100%' });
});
</script>
<script>
{% if messages %}
    {% for message in messages %}
        Toastify({
            text: "{{ message }}",
            duration: 3000,
            close: true,
            gravity: "top", // `top` or `bottom`
            position: "right", // `left`, `center` or `right`
            backgroundColor: "{% if message.tags == 'success' %}#4CAF50{% else %}#F44336{% endif %}", // Green for success, Red for error
            stopOnFocus: true
        }).showToast();
    {% endfor %}
{% endif %}
</script>

{% endblock %}